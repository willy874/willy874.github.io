# 🧾 Product Requirements Document

- **產品名稱**： Merak — 天璇企業網路權限管理系統
- **負責人**： 竹子

---

## 1. 背景與願景（Background & Vision）

隨著企業網路拓撲日益複雜（多雲、混合環境、微服務架構），  
資訊安全已無法單靠網段隔離或防火牆規則達成。

目前的授權機制分散於多個層級（AD、VPN、防火牆、API Gateway），  
導致權限不透明、難以稽核與追蹤，也讓「誰能與誰通訊」成為黑盒。

### 願景

- 讓企業能以「策略為單位」定義、管理、審核服務與使用者間的通訊權限，
- 以安全為前提，實現動態、透明、可稽核的網路通訊治理。

### Core Concepts

- 零信任網路架構（Zero Trust Network Access, ZTNA）
- 權限邊界治理（Access Governance）

---

## 2. 問題定義（Problem Statement）

隨著企業導入雲端、多環境部署與微服務架構，
服務之間的通訊拓撲變得極度複雜且難以掌控。

在現行架構下，企業常面臨以下問題：

- 權限散亂、缺乏整體視圖
  - 通訊授權往往分散在防火牆、VPN、API Gateway、ACL 等不同層級
  - 無法清楚回答：「哪個服務可以和哪個使用者或子網互通？」
- 授權與實際設定不一致
  - 文件規範與實際路由設定常不同步，導致安全空窗或誤封
  - 難以自動稽核、無法及時發現越權行為
- 缺乏可審核的安全邊界
  - 權限開放缺乏變更歷程與責任歸屬
  - 無法滿足資安與法規遵要求
- 跨環境治理困難
  - 服務可能橫跨 on-prem、雲端（AWS、GCP）、VPN、容器網路
  - 每個環境都有不同設定機制，增加操作複雜度與風險

因此，企業迫切需要一套系統，能：

- 將服務、路由、使用者三者的通訊關係「可視化」與「規則化」
- 提供權限審核、版本控管與策略推送
- 成為資訊安全與網路團隊的「共用語言層」

---

## 3. 核心理念（Value Proposition）

以「零信任」為基礎，建立一個能同時被工程師、資安人員與一般員工使用的
通訊權限治理中樞（Communication Access Control Hub）。

此系統提供以下四層價值：

🔹 1. 可視化治理（Visibility & Governance）

將「服務、路由、使用者」三者的通訊關係以拓撲方式呈現，
任何權限開放、修改、撤銷皆可追蹤與稽核，確保每條通訊路徑皆有明確授權依據。

🔹 2. 政策導向的安全模型（Policy-driven Security）

以「策略（Policy）」為最小單位控管通訊行為，
自動比對現況與政策差異，防止越權、誤開或遺漏的設定。

🔹 3. 自助化權限申請（Self-service Access）

提供一般行政與業務人員簡化的權限請求介面，
透過內建流程（申請 → 審批 → 實施）自動化授權，
減少 IT 部門負擔，同時保留完整稽核紀錄。

🔹 4. 自動化與整合能力（Automation & Integration）

支援 API、CLI、Webhook 等整合方式，可與既有安全或網管系統串接（如 AD、IAM、Firewall、Cloud Network）。
在維持安全性的前提下，提升整體維運效率與一致性。

---

## 4. 使用者與使用場景（Target Users & Use Cases）

| 使用者           | 核心任務               | 主要痛點               | 預期改善                       |
| ---------------- | ---------------------- | ---------------------- | ------------------------------ |
| **網路工程師**   | 管理路由與策略         | 多環境配置繁瑣、易出錯 | 統一介面、自動化推送與差異比對 |
| **資安人員**     | 稽核通訊授權           | 權限開放缺乏可追蹤性   | 可視化拓撲與完整審核紀錄       |
| **IT 維運主管**  | 監控安全態勢、審批策略 | 無整體可視化報告       | 一站式報表與稽核儀表板         |
| **一般行政人員** | 申請臨時權限或存取系統 | 申請繁瑣、等待時間長   | 自助式申請 + 自動審批流程      |

---

### Platform 場景

| 使用者        | Platform Name | Target User                   | Device Platform |
| ------------- | ------------- | ----------------------------- | --------------- |
| **Client**    | Agent         | 一般被管理人員                | Window          |
| **Backstage** | Console       | 系統管理者，行政人員、IT 人員 | Web             |

## 5. 核心功能需求（Functional Requirements）

| 模組                              | 功能                   | 描述                                           |
| --------------------------------- | ---------------------- | ---------------------------------------------- |
| **資產管理模組**                  | 服務、使用者、路由註冊 | 將三者建立關聯，形成權限控制基礎資料           |
|                                   | 標籤與群組化           | 可依業務或環境分類（Ex: Finance, Dev, Prod）   |
| **策略管理模組（Policy Engine）** | 定義通訊策略           | 可定義：哪些服務能透過哪些路由與哪些使用者通訊 |
|                                   | 策略衝突檢查           | 偵測重疊或互斥設定                             |
| **授權流程模組**                  | 權限申請與審批         | 一般用戶可提出權限申請，資安人員審批           |
|                                   | 權限到期自動撤銷       | 權限可設定期限，自動回收                       |
| **稽核與版本控管**                | 設定版本追蹤           | 每次策略變更均記錄時間與操作者                 |
|                                   | 稽核報告               | 可匯出符合 ISO/NIST 格式的稽核報告             |
| **拓撲可視化模組**                | 拓撲視圖               | 呈現服務－路由－使用者間的通訊網絡             |
|                                   | 策略差異比對           | 顯示現況與預期策略之落差                       |
| **整合模組（Integration）**       | LDAP / AD 整合         | 匯入組織結構與人員資料                         |
|                                   | Firewall / Cloud API   | 將策略同步推送至防火牆或雲端設定               |

---

## 6. 非功能性需求（Non-functional Requirements）

| 類別           | 描述                                                 |
| -------------- | ---------------------------------------------------- |
| **安全性**     | 所有操作皆需角色權限控制與審核紀錄。支援 SSO / MFA。 |
| **可擴充性**   | 模組容器化設計，支援後續多雲（AWS/GCP/Azure）環境。  |
| **可靠性**     | 系統 SLA 99.9%，核心操作具 rollback 機制。           |
| **審核追蹤性** | 所有策略、設定、使用者行為可回溯。                   |
| **使用體驗**   | 非技術人員能以簡化流程完成權限請求。                 |

---

## 7. 開放議題（Open Questions）

- 權限策略的描述語法（Policy DSL）採 JSON Schema 還是 YAML 格式？是否有業界通用格式？
- 申請流程是否需支援審批請求功能？

---

## 8. 附錄（Appendix）

**相關法遵框架參考：**

- ISO/IEC 27001 — Access Control (A.9)
- NIST SP 800-53 — AC-1 ~ AC-6
- CIS Control v8 — Control 6 (Access Control Management)

(可能都是不必要的)

## 9. 成功指標 (Success Metrics)

| 指標類型         | 衡量方式 | 目標 |
| ---------------- | -------- | ---- |
| 授權治理效率     |          |      |
| 設定一致性       |          |      |
| 安全稽核透明度   |          |      |
| 使用者採用率     |          |      |
| 維運負擔降低     |          |      |
| 異常事件回溯時間 |          |      |

## 10. AI Agent Spec

### 幫我遵守以下規範

- 請文件結果放在程式碼區塊裡，我要一個方便複製的版本
- 請用 markdown 格式顯示，並遵循 markdownlint
- 不需要評估技術和 API 等相關資訊
- 如果有複雜的互動行為，給我 markdown 的 mermaid
- 不要設計任何 API 窗口，使用抽象詞彙（ex: Login request）

### 核心內容

- User Story
- 功能需求
- 名詞解釋
- 參考資料

### 功能需求需包含以下資訊

- 顯示欄位
- 表單填寫欄位及驗證規則
- Action Flow
- 商業邏輯
- 功能如果需要權限，要有權限設計
- 有特殊的 Error 場景要列出來
