import{getDocument as e,getEventTarget as t,getWindow as n,isMac as r,isVirtualClick as i}from"./dist-CzG4t0AR.js";function a(e){return!(e.metaKey||!r()&&e.altKey||e.ctrlKey||e.key===`Control`||e.key===`Shift`||e.key===`Meta`)}var o=new Set([`checkbox`,`radio`,`range`,`color`,`file`,`image`,`button`,`submit`,`reset`]);function s(e,r,i){let a=i?t(i):null,s=n(a);return e=e||a instanceof s.HTMLInputElement&&!o.has(a?.type)||a instanceof s.HTMLTextAreaElement||a instanceof s.HTMLElement&&a.isContentEditable,!(e&&r===`keyboard`&&i instanceof s.KeyboardEvent&&!Reflect.has(p,i.key))}var c=null,l=new Set,u=new Map,d=!1,f=!1,p={Tab:!0,Escape:!0};function m(e,t){for(let n of l)n(e,t)}function h(e){d=!0,a(e)&&(c=`keyboard`,m(`keyboard`,e))}function g(e){c=`pointer`,(e.type===`mousedown`||e.type===`pointerdown`)&&(d=!0,m(`pointer`,e))}function _(e){i(e)&&(d=!0,c=`virtual`)}function v(r){let i=t(r);i===n(i)||i===e(i)||(!d&&!f&&(c=`virtual`,m(`virtual`,r)),d=!1,f=!1)}function y(){d=!1,f=!0}function b(t){if(typeof window>`u`||u.get(n(t)))return;let r=n(t),i=e(t),a=r.HTMLElement.prototype.focus;function o(){c=`virtual`,m(`virtual`,null),d=!0,a.apply(this,arguments)}Object.defineProperty(r.HTMLElement.prototype,`focus`,{configurable:!0,value:o}),i.addEventListener(`keydown`,h,!0),i.addEventListener(`keyup`,h,!0),i.addEventListener(`click`,_,!0),r.addEventListener(`focus`,v,!0),r.addEventListener(`blur`,y,!1),r.PointerEvent===void 0?(i.addEventListener(`mousedown`,g,!0),i.addEventListener(`mousemove`,g,!0),i.addEventListener(`mouseup`,g,!0)):(i.addEventListener(`pointerdown`,g,!0),i.addEventListener(`pointermove`,g,!0),i.addEventListener(`pointerup`,g,!0)),r.addEventListener(`beforeunload`,()=>{x(t)},{once:!0}),u.set(r,{focus:a})}var x=(t,r)=>{let i=n(t),a=e(t);u.has(i)&&(i.HTMLElement.prototype.focus=u.get(i).focus,a.removeEventListener(`keydown`,h,!0),a.removeEventListener(`keyup`,h,!0),a.removeEventListener(`click`,_,!0),i.removeEventListener(`focus`,v,!0),i.removeEventListener(`blur`,y,!1),i.PointerEvent===void 0?(a.removeEventListener(`mousedown`,g,!0),a.removeEventListener(`mousemove`,g,!0),a.removeEventListener(`mouseup`,g,!0)):(a.removeEventListener(`pointerdown`,g,!0),a.removeEventListener(`pointermove`,g,!0),a.removeEventListener(`pointerup`,g,!0)),u.delete(i))};function S(){return c===`keyboard`}function C(e={}){let{isTextInput:t,autoFocus:n,onChange:r,root:i}=e;b(i),r?.({isFocusVisible:n||S(),modality:c});let a=(e,n)=>{s(!!t,e,n)&&r?.({isFocusVisible:S(),modality:e})};return l.add(a),()=>{l.delete(a)}}export{S as isFocusVisible,C as trackFocusVisible};